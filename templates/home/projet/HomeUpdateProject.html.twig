{% extends 'base.html.twig' %}

{% block title %}Modifier le projet {{ projet.titreProjet }}{% endblock %}

{% block body %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card border-0 shadow-lg rounded-4 overflow-hidden">

                <!-- Header -->
                <div class="bg-light text-center py-4 px-3">
                    <i class="bi bi-pencil-square fs-1 text-primary mb-2 d-block"></i>
                    <h4 class="fw-bold mb-1">Modifier le projet</h4>
                    <p class="text-muted small mb-0">
                        Mettez à jour : <span class="fw-semibold">{{ projet.titreProjet }}</span>
                    </p>
                </div>

                <!-- Form body -->
                <div class="p-4 p-md-5">
                    
                    {# Display only success/error flash messages (not validation errors) #}
                    {% for message in app.flashes('success') %}
                        <div class="alert alert-success alert-dismissible fade show mb-4">
                            <i class="bi bi-check-circle me-2"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                    
                    {% for message in app.flashes('error') %}
                        <div class="alert alert-danger alert-dismissible fade show mb-4">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}

                    {{ form_start(form, {'attr': {'novalidate': 'novalidate', 'class': 'needs-validation'}}) }}
                    
                    <div class="row">
                        {# Titre du projet #}
                        <div class="col-md-12 mb-4">
                            {{ form_label(form.titreProjet, 'Titre du projet *', {'label_attr': {'class': 'form-label fw-bold mb-2'}}) }}
                            {{ form_widget(form.titreProjet, {
                                'attr': {
                                    'class': 'form-control form-control-lg',
                                    'placeholder': 'Ex: Application de gestion de projet'
                                }
                            }) }}
                            <div class="form-text mt-1">
                                <i class="bi bi-info-circle me-1"></i> 3 à 150 caractères
                            </div>
                            <div class="text-danger small mt-1">
                                {{ form_errors(form.titreProjet) }}
                            </div>
                        </div>
                        
                        {# Texte court #}
                        <div class="col-md-12 mb-4">
                            {{ form_label(form.text, 'Texte court (résumé) *', {'label_attr': {'class': 'form-label fw-bold mb-2'}}) }}
                            {{ form_widget(form.text, {
                                'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Description courte du projet',
                                    'rows': 3
                                }
                            }) }}
                            <div class="form-text mt-1 d-flex justify-content-between align-items-center">
                                <span>
                                    <i class="bi bi-info-circle me-1"></i> 10 à 255 caractères
                                </span>
                                <span class="small text-muted">
                                    <span id="text-count">{{ projet.text|length }}</span>/255
                                </span>
                            </div>
                            <div class="text-danger small mt-1">
                                {{ form_errors(form.text) }}
                            </div>
                        </div>
                        
                        {# Description détaillée #}
                        <div class="col-md-12 mb-4">
                            {{ form_label(form.description, 'Description détaillée *', {'label_attr': {'class': 'form-label fw-bold mb-2'}}) }}
                            {{ form_widget(form.description, {
                                'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Décrivez en détail votre projet...',
                                    'rows': 6
                                }
                            }) }}
                            <div class="form-text mt-1 d-flex justify-content-between align-items-center">
                                <span>
                                    <i class="bi bi-info-circle me-1"></i> 30 à 2000 caractères
                                </span>
                                <span class="small text-muted">
                                    <span id="description-count">{{ projet.description|length }}</span>/2000
                                </span>
                            </div>
                            <div class="text-danger small mt-1">
                                {{ form_errors(form.description) }}
                            </div>
                        </div>
                        
                        {# Technologies #}
                        <div class="col-md-6 mb-4">
                            {{ form_label(form.technologies, 'Technologies utilisées *', {'label_attr': {'class': 'form-label fw-bold mb-2'}}) }}
                            {{ form_widget(form.technologies, {
                                'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Ex: HTML, CSS, JavaScript, PHP, Symfony, MySQL'
                                }
                            }) }}
                            <div class="form-text mt-1">
                                <i class="bi bi-info-circle me-1"></i> Séparez par des virgules
                            </div>
                            <div class="text-danger small mt-1">
                                {{ form_errors(form.technologies) }}
                            </div>
                        </div>
                        
                        {# Date de réalisation #}
                        <div class="col-md-6 mb-4">
                            {{ form_label(form.dateRealisation, 'Date de réalisation *', {'label_attr': {'class': 'form-label fw-bold mb-2'}}) }}
                            {{ form_widget(form.dateRealisation, {
                                'attr': {
                                    'class': 'form-control'
                                }
                            }) }}
                            <div class="form-text mt-1">
                                <i class="bi bi-info-circle me-1"></i> Ne peut pas être une date future
                            </div>
                            <div class="text-danger small mt-1">
                                {{ form_errors(form.dateRealisation) }}
                            </div>
                        </div>
                        
                        {# Lien de démonstration #}
                        <div class="col-md-12 mb-4">
                            {{ form_label(form.lienDemo, 'Lien de démonstration *', {'label_attr': {'class': 'form-label fw-bold mb-2'}}) }}
                            {{ form_widget(form.lienDemo, {
                                'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'https://exemple.com/demo'
                                }
                            }) }}
                            <div class="form-text mt-1">
                                <i class="bi bi-info-circle me-1"></i> Doit commencer par http:// ou https://
                            </div>
                            <div class="text-danger small mt-1">
                                {{ form_errors(form.lienDemo) }}
                            </div>
                        </div>
                    </div>
                    
                    {# Hidden portfolio field #}
                    {{ form_row(form.portfolio, {'attr': {'class': 'd-none'}}) }}
                    
                    {# Buttons #}
                    <div class="d-flex justify-content-between mt-5 pt-3 border-top">
                        <a href="{{ path('front_projet_show', {'id': projet.id}) }}" class="btn btn-outline-secondary px-4">
                            <i class="bi bi-arrow-left me-2"></i> Annuler
                        </a>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="bi bi-check-circle me-2"></i> Enregistrer
                            </button>
                        </div>
                    </div>
                    
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
</div>

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add Bootstrap validation styling
    const forms = document.querySelectorAll('.needs-validation');
    
    Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // Add was-validated class for Bootstrap styling
            form.classList.add('was-validated');
        }, false);
    });
    
    // Real-time character counters
    const textField = document.querySelector('#{{ form.text.vars.id }}');
    const descriptionField = document.querySelector('#{{ form.description.vars.id }}');
    const textCount = document.querySelector('#text-count');
    const descriptionCount = document.querySelector('#description-count');
    
    if (textField && textCount) {
        // Initial update
        textCount.textContent = textField.value.length;
        
        textField.addEventListener('input', function() {
            textCount.textContent = this.value.length;
            
            // Add warning class when approaching limit
            if (this.value.length > 255 * 0.9) {
                textCount.classList.add('text-warning', 'fw-bold');
            } else {
                textCount.classList.remove('text-warning', 'fw-bold');
            }
            
            // Add danger class when over limit
            if (this.value.length > 255) {
                textCount.classList.add('text-danger', 'fw-bold');
            } else {
                textCount.classList.remove('text-danger');
            }
        });
    }
    
    if (descriptionField && descriptionCount) {
        // Initial update
        descriptionCount.textContent = descriptionField.value.length;
        
        descriptionField.addEventListener('input', function() {
            descriptionCount.textContent = this.value.length;
            
            // Add warning class when approaching limit
            if (this.value.length > 2000 * 0.9) {
                descriptionCount.classList.add('text-warning', 'fw-bold');
            } else {
                descriptionCount.classList.remove('text-warning', 'fw-bold');
            }
            
            // Add danger class when over limit
            if (this.value.length > 2000) {
                descriptionCount.classList.add('text-danger', 'fw-bold');
            } else {
                descriptionCount.classList.remove('text-danger');
            }
        });
    }
});
</script>
{% endblock %}
{% endblock %}