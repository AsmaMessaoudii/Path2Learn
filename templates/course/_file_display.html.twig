{# templates/course/_file_display.html.twig #}

{# Template pour afficher différents types de fichiers #}

{% macro displayFile(resource, course) %}
    {% if resource.fileName %}
        {# Fichier uploadé #}
        {% set extension = resource.fileName|lower|split('.')|last %}
        
        <div class="card mb-3 border-0 shadow-sm">
            <div class="card-body p-3">
                <div class="d-flex align-items-start">
                    <!-- Icône selon le type de fichier -->
                    <div class="me-3">
                        {% if extension in ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'] %}
                            <div class="bg-success bg-opacity-10 p-3 rounded-circle">
                                <i class="fas fa-image text-success fa-lg"></i>
                            </div>
                        {% elseif extension == 'pdf' %}
                            <div class="bg-danger bg-opacity-10 p-3 rounded-circle">
                                <i class="fas fa-file-pdf text-danger fa-lg"></i>
                            </div>
                        {% elseif extension in ['mp4', 'mov', 'avi', 'mkv', 'webm', 'wmv'] %}
                            <div class="bg-primary bg-opacity-10 p-3 rounded-circle">
                                <i class="fas fa-video text-primary fa-lg"></i>
                            </div>
                        {% elseif extension in ['mp3', 'wav', 'ogg', 'm4a', 'flac'] %}
                            <div class="bg-warning bg-opacity-10 p-3 rounded-circle">
                                <i class="fas fa-music text-warning fa-lg"></i>
                            </div>
                        {% elseif extension in ['doc', 'docx'] %}
                            <div class="bg-info bg-opacity-10 p-3 rounded-circle">
                                <i class="fas fa-file-word text-info fa-lg"></i>
                            </div>
                        {% elseif extension in ['xls', 'xlsx', 'csv'] %}
                            <div class="bg-success bg-opacity-10 p-3 rounded-circle">
                                <i class="fas fa-file-excel text-success fa-lg"></i>
                            </div>
                        {% else %}
                            <div class="bg-secondary bg-opacity-10 p-3 rounded-circle">
                                <i class="fas fa-file text-secondary fa-lg"></i>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Informations du fichier -->
                    <div class="flex-grow-1">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <h6 class="mb-1">{{ resource.titre }}</h6>
                                <small class="text-muted">
                                    {{ resource.fileName }} 
                                    <span class="badge bg-light text-dark ms-2">
                                        {{ extension|upper }}
                                    </span>
                                </small>
                            </div>
                        </div>
                        
                        <!-- Prévisualisation selon le type -->
                        <div class="mt-3">
                            {% if extension in ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'] %}
                                <!-- Prévisualisation d'image -->
                                <div class="text-center mb-3">
                                    <img src="{{ asset('uploads/ressources/' ~ resource.fileName) }}" 
                                         alt="{{ resource.titre }}" 
                                         class="img-fluid rounded shadow-sm" 
                                         style="max-height: 200px; cursor: pointer;"
                                         onclick="openImageViewer('{{ asset('uploads/ressources/' ~ resource.fileName) }}', '{{ resource.titre }}')">
                                    <small class="text-muted d-block mt-2">Cliquez pour agrandir l'image</small>
                                </div>
                                
                            {% elseif extension in ['mp4', 'mov', 'avi', 'mkv', 'webm', 'wmv'] %}
                                <!-- Lecteur vidéo -->
                                <div class="bg-dark rounded p-2 mb-3">
                                    <video controls class="w-100" style="max-height: 200px;">
                                        <source src="{{ asset('uploads/ressources/' ~ resource.fileName) }}" 
                                                type="video/{{ extension }}">
                                        Votre navigateur ne supporte pas la lecture de vidéos.
                                    </video>
                                </div>
                                
                            {% elseif extension == 'pdf' %}
                                <!-- Aperçu PDF (iframe) -->
                                <div class="border rounded p-2 mb-3">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <small class="text-muted">Aperçu du PDF</small>
                                        <button class="btn btn-sm btn-outline-primary" 
                                                onclick="openPdfViewer('{{ asset('uploads/ressources/' ~ resource.fileName) }}', '{{ resource.titre }}')">
                                            <i class="fas fa-expand me-1"></i> Plein écran
                                        </button>
                                    </div>
                                    <iframe src="{{ asset('uploads/ressources/' ~ resource.fileName) }}#toolbar=0&navpanes=0" 
                                            class="w-100" 
                                            style="height: 300px; border: none;">
                                    </iframe>
                                </div>
                                
                            {% elseif extension in ['mp3', 'wav', 'ogg', 'm4a', 'flac'] %}
                                <!-- Lecteur audio -->
                                <div class="border rounded p-3 mb-3">
                                    <audio controls class="w-100">
                                        <source src="{{ asset('uploads/ressources/' ~ resource.fileName) }}" 
                                                type="audio/{{ extension }}">
                                        Votre navigateur ne supporte pas l'audio.
                                    </audio>
                                </div>
                                
                            {% else %}
                                <!-- Pour les autres types de fichiers -->
                                <div class="alert alert-info mb-3">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Ce fichier ne peut pas être prévisualisé dans le navigateur.
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Actions -->
                        <div class="d-flex flex-wrap gap-2 mt-3">
                            <!-- Télécharger -->
                            <a href="{{ path('course_ressource_download', {'id': resource.id}) }}" 
                               class="btn btn-sm btn-primary" 
                               download>
                                <i class="fas fa-download me-1"></i> Télécharger
                            </a>
                            
                            <!-- Voir dans un nouvel onglet -->
                            <a href="{{ asset('uploads/ressources/' ~ resource.fileName) }}" 
                               target="_blank" 
                               class="btn btn-sm btn-outline-secondary">
                                <i class="fas fa-external-link-alt me-1"></i> Ouvrir
                            </a>
                            
                            <!-- PDF -->
                            <a href="{{ path('single_ressource_pdf', {'id': course.id, 'ressourceId': resource.id}) }}" 
                               class="btn btn-sm btn-outline-danger" 
                               target="_blank">
                                <i class="fas fa-file-pdf me-1"></i> Générer PDF
                            </a>
                            
                            <!-- Informations -->
                            <button class="btn btn-sm btn-outline-info" 
                                    type="button" 
                                    data-bs-toggle="collapse" 
                                    data-bs-target="#fileInfo{{ resource.id }}">
                                <i class="fas fa-info-circle me-1"></i> Infos
                            </button>
                        </div>
                        
                        <!-- Informations détaillées (collapsible) -->
                        <div class="collapse mt-3" id="fileInfo{{ resource.id }}">
                            <div class="card card-body">
                                <div class="row small">
                                    <div class="col-md-6">
                                        <strong>Type :</strong> {{ resource.type }}<br>
                                        <strong>Format :</strong> {{ extension|upper }}<br>
                                        <strong>Ajouté le :</strong> {{ resource.dateAjout|date('d/m/Y') }}
                                    </div>
                                    <div class="col-md-6">
                                        <strong>Taille :</strong> 
                                        {# Replace line 163 (and the following lines) #}
{% if resource.filename %}
    {# File exists logic - show download link #}
    <a href="{{ asset('uploads/ressources/' ~ resource.filename) }}" target="_blank" class="btn btn-primary">
        <i class="fas fa-download"></i> Télécharger
    </a>
{% else %}
    {# No file - show warning #}
    <span class="text-muted">Fichier non disponible</span>
{% endif %}
                                        {% endif %}<br>
                                        <strong>Partage :</strong>
                                        <button class="btn btn-sm btn-outline-dark btn-copy" 
                                                data-clipboard-text="{{ asset('uploads/ressources/' ~ resource.fileName) }}">
                                            <i class="fas fa-copy me-1"></i> Copier le lien
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Lien externe -->
        <div class="card mb-3 border-0 shadow-sm">
            <div class="card-body p-3">
                <div class="d-flex align-items-start">
                    <div class="me-3">
                        <div class="bg-info bg-opacity-10 p-3 rounded-circle">
                            <i class="fas fa-link text-info fa-lg"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1">
                        <h6 class="mb-1">{{ resource.titre }}</h6>
                        <p class="text-muted small mb-2">
                            <a href="{{ resource.url }}" target="_blank" class="text-break">
                                {{ resource.url }}
                            </a>
                        </p>
                        <div class="d-flex flex-wrap gap-2">
                            <a href="{{ resource.url }}" target="_blank" class="btn btn-sm btn-primary">
                                <i class="fas fa-external-link-alt me-1"></i> Visiter le lien
                            </a>
                            <a href="{{ path('single_ressource_pdf', {'id': course.id, 'ressourceId': resource.id}) }}" 
                               class="btn btn-sm btn-outline-danger" 
                               target="_blank">
                                <i class="fas fa-file-pdf me-1"></i> Générer PDF
                            </a>
                            <button class="btn btn-sm btn-outline-dark btn-copy" 
                                    data-clipboard-text="{{ resource.url }}">
                                <i class="fas fa-copy me-1"></i> Copier l'URL
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
{% endmacro %}